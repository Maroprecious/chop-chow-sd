{"ast":null,"code":"import { __assign, __awaiter, __generator } from \"tslib\";\nimport { HttpRequest } from \"@aws-sdk/protocol-http\";\nimport { parse as parseArn, validate as validateArn } from \"@aws-sdk/util-arn-parser\";\nimport { bucketHostname } from \"./bucketHostname\";\nexport var bucketEndpointMiddleware = function bucketEndpointMiddleware(options) {\n  return function (next, context) {\n    return function (args) {\n      return __awaiter(void 0, void 0, void 0, function () {\n        var bucketName, replaceBucketInPath, request, bucketArn, clientRegion, useDualstackEndpoint, useFipsEndpoint, _a, partition, _b, signingRegion, useArnRegion, _c, hostname, bucketEndpoint, modifiedSigningRegion, signingService, _d, clientRegion, dualstackEndpoint, fipsEndpoint, _e, hostname, bucketEndpoint;\n\n        var _f;\n\n        return __generator(this, function (_g) {\n          switch (_g.label) {\n            case 0:\n              bucketName = args.input.Bucket;\n              replaceBucketInPath = options.bucketEndpoint;\n              request = args.request;\n              if (!HttpRequest.isInstance(request)) return [3, 13];\n              if (!options.bucketEndpoint) return [3, 1];\n              request.hostname = bucketName;\n              return [3, 12];\n\n            case 1:\n              if (!validateArn(bucketName)) return [3, 8];\n              bucketArn = parseArn(bucketName);\n              return [4, options.region()];\n\n            case 2:\n              clientRegion = _g.sent();\n              return [4, options.useDualstackEndpoint()];\n\n            case 3:\n              useDualstackEndpoint = _g.sent();\n              return [4, options.useFipsEndpoint()];\n\n            case 4:\n              useFipsEndpoint = _g.sent();\n              return [4, options.regionInfoProvider(clientRegion, {\n                useDualstackEndpoint: useDualstackEndpoint,\n                useFipsEndpoint: useFipsEndpoint\n              })];\n\n            case 5:\n              _a = _g.sent() || {}, partition = _a.partition, _b = _a.signingRegion, signingRegion = _b === void 0 ? clientRegion : _b;\n              return [4, options.useArnRegion()];\n\n            case 6:\n              useArnRegion = _g.sent();\n              _d = bucketHostname;\n              _f = {\n                bucketName: bucketArn,\n                baseHostname: request.hostname,\n                accelerateEndpoint: options.useAccelerateEndpoint,\n                dualstackEndpoint: useDualstackEndpoint,\n                fipsEndpoint: useFipsEndpoint,\n                pathStyleEndpoint: options.forcePathStyle,\n                tlsCompatible: request.protocol === \"https:\",\n                useArnRegion: useArnRegion,\n                clientPartition: partition,\n                clientSigningRegion: signingRegion,\n                clientRegion: clientRegion,\n                isCustomEndpoint: options.isCustomEndpoint\n              };\n              return [4, options.disableMultiregionAccessPoints()];\n\n            case 7:\n              _c = _d.apply(void 0, [(_f.disableMultiregionAccessPoints = _g.sent(), _f)]), hostname = _c.hostname, bucketEndpoint = _c.bucketEndpoint, modifiedSigningRegion = _c.signingRegion, signingService = _c.signingService;\n\n              if (modifiedSigningRegion && modifiedSigningRegion !== signingRegion) {\n                context[\"signing_region\"] = modifiedSigningRegion;\n              }\n\n              if (signingService && signingService !== \"s3\") {\n                context[\"signing_service\"] = signingService;\n              }\n\n              request.hostname = hostname;\n              replaceBucketInPath = bucketEndpoint;\n              return [3, 12];\n\n            case 8:\n              return [4, options.region()];\n\n            case 9:\n              clientRegion = _g.sent();\n              return [4, options.useDualstackEndpoint()];\n\n            case 10:\n              dualstackEndpoint = _g.sent();\n              return [4, options.useFipsEndpoint()];\n\n            case 11:\n              fipsEndpoint = _g.sent();\n              _e = bucketHostname({\n                bucketName: bucketName,\n                clientRegion: clientRegion,\n                baseHostname: request.hostname,\n                accelerateEndpoint: options.useAccelerateEndpoint,\n                dualstackEndpoint: dualstackEndpoint,\n                fipsEndpoint: fipsEndpoint,\n                pathStyleEndpoint: options.forcePathStyle,\n                tlsCompatible: request.protocol === \"https:\",\n                isCustomEndpoint: options.isCustomEndpoint\n              }), hostname = _e.hostname, bucketEndpoint = _e.bucketEndpoint;\n              request.hostname = hostname;\n              replaceBucketInPath = bucketEndpoint;\n              _g.label = 12;\n\n            case 12:\n              if (replaceBucketInPath) {\n                request.path = request.path.replace(/^(\\/)?[^\\/]+/, \"\");\n\n                if (request.path === \"\") {\n                  request.path = \"/\";\n                }\n              }\n\n              _g.label = 13;\n\n            case 13:\n              return [2, next(__assign(__assign({}, args), {\n                request: request\n              }))];\n          }\n        });\n      });\n    };\n  };\n};\nexport var bucketEndpointMiddlewareOptions = {\n  tags: [\"BUCKET_ENDPOINT\"],\n  name: \"bucketEndpointMiddleware\",\n  relation: \"before\",\n  toMiddleware: \"hostHeaderMiddleware\",\n  override: true\n};\nexport var getBucketEndpointPlugin = function getBucketEndpointPlugin(options) {\n  return {\n    applyToStack: function applyToStack(clientStack) {\n      clientStack.addRelativeTo(bucketEndpointMiddleware(options), bucketEndpointMiddlewareOptions);\n    }\n  };\n};","map":{"version":3,"sources":["/home/chuka/joe/ChopChowSD/node_modules/@aws-sdk/middleware-bucket-endpoint/dist-es/bucketEndpointMiddleware.js"],"names":["__assign","__awaiter","__generator","HttpRequest","parse","parseArn","validate","validateArn","bucketHostname","bucketEndpointMiddleware","options","next","context","args","bucketName","replaceBucketInPath","request","bucketArn","clientRegion","useDualstackEndpoint","useFipsEndpoint","_a","partition","_b","signingRegion","useArnRegion","_c","hostname","bucketEndpoint","modifiedSigningRegion","signingService","_d","dualstackEndpoint","fipsEndpoint","_e","_f","_g","label","input","Bucket","isInstance","region","sent","regionInfoProvider","baseHostname","accelerateEndpoint","useAccelerateEndpoint","pathStyleEndpoint","forcePathStyle","tlsCompatible","protocol","clientPartition","clientSigningRegion","isCustomEndpoint","disableMultiregionAccessPoints","apply","path","replace","bucketEndpointMiddlewareOptions","tags","name","relation","toMiddleware","override","getBucketEndpointPlugin","applyToStack","clientStack","addRelativeTo"],"mappings":"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","sourcesContent":["import { __assign, __awaiter, __generator } from \"tslib\";\nimport { HttpRequest } from \"@aws-sdk/protocol-http\";\nimport { parse as parseArn, validate as validateArn } from \"@aws-sdk/util-arn-parser\";\nimport { bucketHostname } from \"./bucketHostname\";\nexport var bucketEndpointMiddleware = function (options) {\n    return function (next, context) {\n        return function (args) { return __awaiter(void 0, void 0, void 0, function () {\n            var bucketName, replaceBucketInPath, request, bucketArn, clientRegion, useDualstackEndpoint, useFipsEndpoint, _a, partition, _b, signingRegion, useArnRegion, _c, hostname, bucketEndpoint, modifiedSigningRegion, signingService, _d, clientRegion, dualstackEndpoint, fipsEndpoint, _e, hostname, bucketEndpoint;\n            var _f;\n            return __generator(this, function (_g) {\n                switch (_g.label) {\n                    case 0:\n                        bucketName = args.input.Bucket;\n                        replaceBucketInPath = options.bucketEndpoint;\n                        request = args.request;\n                        if (!HttpRequest.isInstance(request)) return [3, 13];\n                        if (!options.bucketEndpoint) return [3, 1];\n                        request.hostname = bucketName;\n                        return [3, 12];\n                    case 1:\n                        if (!validateArn(bucketName)) return [3, 8];\n                        bucketArn = parseArn(bucketName);\n                        return [4, options.region()];\n                    case 2:\n                        clientRegion = _g.sent();\n                        return [4, options.useDualstackEndpoint()];\n                    case 3:\n                        useDualstackEndpoint = _g.sent();\n                        return [4, options.useFipsEndpoint()];\n                    case 4:\n                        useFipsEndpoint = _g.sent();\n                        return [4, options.regionInfoProvider(clientRegion, { useDualstackEndpoint: useDualstackEndpoint, useFipsEndpoint: useFipsEndpoint })];\n                    case 5:\n                        _a = (_g.sent()) || {}, partition = _a.partition, _b = _a.signingRegion, signingRegion = _b === void 0 ? clientRegion : _b;\n                        return [4, options.useArnRegion()];\n                    case 6:\n                        useArnRegion = _g.sent();\n                        _d = bucketHostname;\n                        _f = {\n                            bucketName: bucketArn,\n                            baseHostname: request.hostname,\n                            accelerateEndpoint: options.useAccelerateEndpoint,\n                            dualstackEndpoint: useDualstackEndpoint,\n                            fipsEndpoint: useFipsEndpoint,\n                            pathStyleEndpoint: options.forcePathStyle,\n                            tlsCompatible: request.protocol === \"https:\",\n                            useArnRegion: useArnRegion,\n                            clientPartition: partition,\n                            clientSigningRegion: signingRegion,\n                            clientRegion: clientRegion,\n                            isCustomEndpoint: options.isCustomEndpoint\n                        };\n                        return [4, options.disableMultiregionAccessPoints()];\n                    case 7:\n                        _c = _d.apply(void 0, [(_f.disableMultiregionAccessPoints = _g.sent(),\n                                _f)]), hostname = _c.hostname, bucketEndpoint = _c.bucketEndpoint, modifiedSigningRegion = _c.signingRegion, signingService = _c.signingService;\n                        if (modifiedSigningRegion && modifiedSigningRegion !== signingRegion) {\n                            context[\"signing_region\"] = modifiedSigningRegion;\n                        }\n                        if (signingService && signingService !== \"s3\") {\n                            context[\"signing_service\"] = signingService;\n                        }\n                        request.hostname = hostname;\n                        replaceBucketInPath = bucketEndpoint;\n                        return [3, 12];\n                    case 8: return [4, options.region()];\n                    case 9:\n                        clientRegion = _g.sent();\n                        return [4, options.useDualstackEndpoint()];\n                    case 10:\n                        dualstackEndpoint = _g.sent();\n                        return [4, options.useFipsEndpoint()];\n                    case 11:\n                        fipsEndpoint = _g.sent();\n                        _e = bucketHostname({\n                            bucketName: bucketName,\n                            clientRegion: clientRegion,\n                            baseHostname: request.hostname,\n                            accelerateEndpoint: options.useAccelerateEndpoint,\n                            dualstackEndpoint: dualstackEndpoint,\n                            fipsEndpoint: fipsEndpoint,\n                            pathStyleEndpoint: options.forcePathStyle,\n                            tlsCompatible: request.protocol === \"https:\",\n                            isCustomEndpoint: options.isCustomEndpoint,\n                        }), hostname = _e.hostname, bucketEndpoint = _e.bucketEndpoint;\n                        request.hostname = hostname;\n                        replaceBucketInPath = bucketEndpoint;\n                        _g.label = 12;\n                    case 12:\n                        if (replaceBucketInPath) {\n                            request.path = request.path.replace(/^(\\/)?[^\\/]+/, \"\");\n                            if (request.path === \"\") {\n                                request.path = \"/\";\n                            }\n                        }\n                        _g.label = 13;\n                    case 13: return [2, next(__assign(__assign({}, args), { request: request }))];\n                }\n            });\n        }); };\n    };\n};\nexport var bucketEndpointMiddlewareOptions = {\n    tags: [\"BUCKET_ENDPOINT\"],\n    name: \"bucketEndpointMiddleware\",\n    relation: \"before\",\n    toMiddleware: \"hostHeaderMiddleware\",\n    override: true,\n};\nexport var getBucketEndpointPlugin = function (options) { return ({\n    applyToStack: function (clientStack) {\n        clientStack.addRelativeTo(bucketEndpointMiddleware(options), bucketEndpointMiddlewareOptions);\n    },\n}); };\n"]},"metadata":{},"sourceType":"module"}