{"ast":null,"code":"import { __awaiter, __generator } from \"tslib\";\nimport { sleep } from \"./utils/sleep\";\nimport { WaiterState } from \"./waiter\";\n\nvar exponentialBackoffWithJitter = function exponentialBackoffWithJitter(minDelay, maxDelay, attemptCeiling, attempt) {\n  if (attempt > attemptCeiling) return maxDelay;\n  var delay = minDelay * Math.pow(2, attempt - 1);\n  return randomInRange(minDelay, delay);\n};\n\nvar randomInRange = function randomInRange(min, max) {\n  return min + Math.random() * (max - min);\n};\n\nexport var runPolling = function runPolling(_a, input, acceptorChecks) {\n  var minDelay = _a.minDelay,\n      maxDelay = _a.maxDelay,\n      maxWaitTime = _a.maxWaitTime,\n      abortController = _a.abortController,\n      client = _a.client,\n      abortSignal = _a.abortSignal;\n  return __awaiter(void 0, void 0, void 0, function () {\n    var state, currentAttempt, waitUntil, attemptCeiling, delay, state_1;\n\n    var _b;\n\n    return __generator(this, function (_c) {\n      switch (_c.label) {\n        case 0:\n          return [4, acceptorChecks(client, input)];\n\n        case 1:\n          state = _c.sent().state;\n\n          if (state !== WaiterState.RETRY) {\n            return [2, {\n              state: state\n            }];\n          }\n\n          currentAttempt = 1;\n          waitUntil = Date.now() + maxWaitTime * 1000;\n          attemptCeiling = Math.log(maxDelay / minDelay) / Math.log(2) + 1;\n          _c.label = 2;\n\n        case 2:\n          if (!true) return [3, 5];\n\n          if (((_b = abortController === null || abortController === void 0 ? void 0 : abortController.signal) === null || _b === void 0 ? void 0 : _b.aborted) || (abortSignal === null || abortSignal === void 0 ? void 0 : abortSignal.aborted)) {\n            return [2, {\n              state: WaiterState.ABORTED\n            }];\n          }\n\n          delay = exponentialBackoffWithJitter(minDelay, maxDelay, attemptCeiling, currentAttempt);\n\n          if (Date.now() + delay * 1000 > waitUntil) {\n            return [2, {\n              state: WaiterState.TIMEOUT\n            }];\n          }\n\n          return [4, sleep(delay)];\n\n        case 3:\n          _c.sent();\n\n          return [4, acceptorChecks(client, input)];\n\n        case 4:\n          state_1 = _c.sent().state;\n\n          if (state_1 !== WaiterState.RETRY) {\n            return [2, {\n              state: state_1\n            }];\n          }\n\n          currentAttempt += 1;\n          return [3, 2];\n\n        case 5:\n          return [2];\n      }\n    });\n  });\n};","map":{"version":3,"sources":["/home/chuka/joe/ChopChowSD/node_modules/@aws-sdk/util-waiter/dist-es/poller.js"],"names":["__awaiter","__generator","sleep","WaiterState","exponentialBackoffWithJitter","minDelay","maxDelay","attemptCeiling","attempt","delay","Math","pow","randomInRange","min","max","random","runPolling","_a","input","acceptorChecks","maxWaitTime","abortController","client","abortSignal","state","currentAttempt","waitUntil","state_1","_b","_c","label","sent","RETRY","Date","now","log","signal","aborted","ABORTED","TIMEOUT"],"mappings":"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","sourcesContent":["import { __awaiter, __generator } from \"tslib\";\nimport { sleep } from \"./utils/sleep\";\nimport { WaiterState } from \"./waiter\";\nvar exponentialBackoffWithJitter = function (minDelay, maxDelay, attemptCeiling, attempt) {\n    if (attempt > attemptCeiling)\n        return maxDelay;\n    var delay = minDelay * Math.pow(2, (attempt - 1));\n    return randomInRange(minDelay, delay);\n};\nvar randomInRange = function (min, max) { return min + Math.random() * (max - min); };\nexport var runPolling = function (_a, input, acceptorChecks) {\n    var minDelay = _a.minDelay, maxDelay = _a.maxDelay, maxWaitTime = _a.maxWaitTime, abortController = _a.abortController, client = _a.client, abortSignal = _a.abortSignal;\n    return __awaiter(void 0, void 0, void 0, function () {\n        var state, currentAttempt, waitUntil, attemptCeiling, delay, state_1;\n        var _b;\n        return __generator(this, function (_c) {\n            switch (_c.label) {\n                case 0: return [4, acceptorChecks(client, input)];\n                case 1:\n                    state = (_c.sent()).state;\n                    if (state !== WaiterState.RETRY) {\n                        return [2, { state: state }];\n                    }\n                    currentAttempt = 1;\n                    waitUntil = Date.now() + maxWaitTime * 1000;\n                    attemptCeiling = Math.log(maxDelay / minDelay) / Math.log(2) + 1;\n                    _c.label = 2;\n                case 2:\n                    if (!true) return [3, 5];\n                    if (((_b = abortController === null || abortController === void 0 ? void 0 : abortController.signal) === null || _b === void 0 ? void 0 : _b.aborted) || (abortSignal === null || abortSignal === void 0 ? void 0 : abortSignal.aborted)) {\n                        return [2, { state: WaiterState.ABORTED }];\n                    }\n                    delay = exponentialBackoffWithJitter(minDelay, maxDelay, attemptCeiling, currentAttempt);\n                    if (Date.now() + delay * 1000 > waitUntil) {\n                        return [2, { state: WaiterState.TIMEOUT }];\n                    }\n                    return [4, sleep(delay)];\n                case 3:\n                    _c.sent();\n                    return [4, acceptorChecks(client, input)];\n                case 4:\n                    state_1 = (_c.sent()).state;\n                    if (state_1 !== WaiterState.RETRY) {\n                        return [2, { state: state_1 }];\n                    }\n                    currentAttempt += 1;\n                    return [3, 2];\n                case 5: return [2];\n            }\n        });\n    });\n};\n"]},"metadata":{},"sourceType":"module"}