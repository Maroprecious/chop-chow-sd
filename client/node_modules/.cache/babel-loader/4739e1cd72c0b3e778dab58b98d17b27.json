{"ast":null,"code":"import { Crc32 } from \"@aws-crypto/crc32\";\nimport { HeaderMarshaller } from \"./HeaderMarshaller\";\nimport { splitMessage } from \"./splitMessage\";\n\nvar EventStreamMarshaller = function () {\n  function EventStreamMarshaller(toUtf8, fromUtf8) {\n    this.headerMarshaller = new HeaderMarshaller(toUtf8, fromUtf8);\n  }\n\n  EventStreamMarshaller.prototype.marshall = function (_a) {\n    var rawHeaders = _a.headers,\n        body = _a.body;\n    var headers = this.headerMarshaller.format(rawHeaders);\n    var length = headers.byteLength + body.byteLength + 16;\n    var out = new Uint8Array(length);\n    var view = new DataView(out.buffer, out.byteOffset, out.byteLength);\n    var checksum = new Crc32();\n    view.setUint32(0, length, false);\n    view.setUint32(4, headers.byteLength, false);\n    view.setUint32(8, checksum.update(out.subarray(0, 8)).digest(), false);\n    out.set(headers, 12);\n    out.set(body, headers.byteLength + 12);\n    view.setUint32(length - 4, checksum.update(out.subarray(8, length - 4)).digest(), false);\n    return out;\n  };\n\n  EventStreamMarshaller.prototype.unmarshall = function (message) {\n    var _a = splitMessage(message),\n        headers = _a.headers,\n        body = _a.body;\n\n    return {\n      headers: this.headerMarshaller.parse(headers),\n      body: body\n    };\n  };\n\n  EventStreamMarshaller.prototype.formatHeaders = function (rawHeaders) {\n    return this.headerMarshaller.format(rawHeaders);\n  };\n\n  return EventStreamMarshaller;\n}();\n\nexport { EventStreamMarshaller };","map":{"version":3,"sources":["/home/chuka/joe/ChopChowSD/node_modules/@aws-sdk/eventstream-marshaller/dist-es/EventStreamMarshaller.js"],"names":["Crc32","HeaderMarshaller","splitMessage","EventStreamMarshaller","toUtf8","fromUtf8","headerMarshaller","prototype","marshall","_a","rawHeaders","headers","body","format","length","byteLength","out","Uint8Array","view","DataView","buffer","byteOffset","checksum","setUint32","update","subarray","digest","set","unmarshall","message","parse","formatHeaders"],"mappings":"AAAA,SAASA,KAAT,QAAsB,mBAAtB;AACA,SAASC,gBAAT,QAAiC,oBAAjC;AACA,SAASC,YAAT,QAA6B,gBAA7B;;AACA,IAAIC,qBAAqB,GAAI,YAAY;AACrC,WAASA,qBAAT,CAA+BC,MAA/B,EAAuCC,QAAvC,EAAiD;AAC7C,SAAKC,gBAAL,GAAwB,IAAIL,gBAAJ,CAAqBG,MAArB,EAA6BC,QAA7B,CAAxB;AACH;;AACDF,EAAAA,qBAAqB,CAACI,SAAtB,CAAgCC,QAAhC,GAA2C,UAAUC,EAAV,EAAc;AACrD,QAAIC,UAAU,GAAGD,EAAE,CAACE,OAApB;AAAA,QAA6BC,IAAI,GAAGH,EAAE,CAACG,IAAvC;AACA,QAAID,OAAO,GAAG,KAAKL,gBAAL,CAAsBO,MAAtB,CAA6BH,UAA7B,CAAd;AACA,QAAII,MAAM,GAAGH,OAAO,CAACI,UAAR,GAAqBH,IAAI,CAACG,UAA1B,GAAuC,EAApD;AACA,QAAIC,GAAG,GAAG,IAAIC,UAAJ,CAAeH,MAAf,CAAV;AACA,QAAII,IAAI,GAAG,IAAIC,QAAJ,CAAaH,GAAG,CAACI,MAAjB,EAAyBJ,GAAG,CAACK,UAA7B,EAAyCL,GAAG,CAACD,UAA7C,CAAX;AACA,QAAIO,QAAQ,GAAG,IAAItB,KAAJ,EAAf;AACAkB,IAAAA,IAAI,CAACK,SAAL,CAAe,CAAf,EAAkBT,MAAlB,EAA0B,KAA1B;AACAI,IAAAA,IAAI,CAACK,SAAL,CAAe,CAAf,EAAkBZ,OAAO,CAACI,UAA1B,EAAsC,KAAtC;AACAG,IAAAA,IAAI,CAACK,SAAL,CAAe,CAAf,EAAkBD,QAAQ,CAACE,MAAT,CAAgBR,GAAG,CAACS,QAAJ,CAAa,CAAb,EAAgB,CAAhB,CAAhB,EAAoCC,MAApC,EAAlB,EAAgE,KAAhE;AACAV,IAAAA,GAAG,CAACW,GAAJ,CAAQhB,OAAR,EAAiB,EAAjB;AACAK,IAAAA,GAAG,CAACW,GAAJ,CAAQf,IAAR,EAAcD,OAAO,CAACI,UAAR,GAAqB,EAAnC;AACAG,IAAAA,IAAI,CAACK,SAAL,CAAeT,MAAM,GAAG,CAAxB,EAA2BQ,QAAQ,CAACE,MAAT,CAAgBR,GAAG,CAACS,QAAJ,CAAa,CAAb,EAAgBX,MAAM,GAAG,CAAzB,CAAhB,EAA6CY,MAA7C,EAA3B,EAAkF,KAAlF;AACA,WAAOV,GAAP;AACH,GAdD;;AAeAb,EAAAA,qBAAqB,CAACI,SAAtB,CAAgCqB,UAAhC,GAA6C,UAAUC,OAAV,EAAmB;AAC5D,QAAIpB,EAAE,GAAGP,YAAY,CAAC2B,OAAD,CAArB;AAAA,QAAgClB,OAAO,GAAGF,EAAE,CAACE,OAA7C;AAAA,QAAsDC,IAAI,GAAGH,EAAE,CAACG,IAAhE;;AACA,WAAO;AAAED,MAAAA,OAAO,EAAE,KAAKL,gBAAL,CAAsBwB,KAAtB,CAA4BnB,OAA5B,CAAX;AAAiDC,MAAAA,IAAI,EAAEA;AAAvD,KAAP;AACH,GAHD;;AAIAT,EAAAA,qBAAqB,CAACI,SAAtB,CAAgCwB,aAAhC,GAAgD,UAAUrB,UAAV,EAAsB;AAClE,WAAO,KAAKJ,gBAAL,CAAsBO,MAAtB,CAA6BH,UAA7B,CAAP;AACH,GAFD;;AAGA,SAAOP,qBAAP;AACH,CA3B4B,EAA7B;;AA4BA,SAASA,qBAAT","sourcesContent":["import { Crc32 } from \"@aws-crypto/crc32\";\nimport { HeaderMarshaller } from \"./HeaderMarshaller\";\nimport { splitMessage } from \"./splitMessage\";\nvar EventStreamMarshaller = (function () {\n    function EventStreamMarshaller(toUtf8, fromUtf8) {\n        this.headerMarshaller = new HeaderMarshaller(toUtf8, fromUtf8);\n    }\n    EventStreamMarshaller.prototype.marshall = function (_a) {\n        var rawHeaders = _a.headers, body = _a.body;\n        var headers = this.headerMarshaller.format(rawHeaders);\n        var length = headers.byteLength + body.byteLength + 16;\n        var out = new Uint8Array(length);\n        var view = new DataView(out.buffer, out.byteOffset, out.byteLength);\n        var checksum = new Crc32();\n        view.setUint32(0, length, false);\n        view.setUint32(4, headers.byteLength, false);\n        view.setUint32(8, checksum.update(out.subarray(0, 8)).digest(), false);\n        out.set(headers, 12);\n        out.set(body, headers.byteLength + 12);\n        view.setUint32(length - 4, checksum.update(out.subarray(8, length - 4)).digest(), false);\n        return out;\n    };\n    EventStreamMarshaller.prototype.unmarshall = function (message) {\n        var _a = splitMessage(message), headers = _a.headers, body = _a.body;\n        return { headers: this.headerMarshaller.parse(headers), body: body };\n    };\n    EventStreamMarshaller.prototype.formatHeaders = function (rawHeaders) {\n        return this.headerMarshaller.format(rawHeaders);\n    };\n    return EventStreamMarshaller;\n}());\nexport { EventStreamMarshaller };\n"]},"metadata":{},"sourceType":"module"}